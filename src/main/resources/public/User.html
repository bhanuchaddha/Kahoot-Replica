<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script type="text/javascript">
            var stompClient = null;

            function setConnected(connected) {
                document.getElementById('connect').disabled = connected;
                document.getElementById('disconnect').disabled = !connected;
                document.getElementById('conversationDiv').style.visibility
                  = connected ? 'visible' : 'hidden';
            }

            function connect() {
                var socket = new SockJS('/socket');
                stompClient = Stomp.over(socket);
                stompClient.connect({}, function(frame) {
                    setConnected(true);
                    console.log('Connected: ' + frame);

                    stompClient.subscribe('/answer', function(data) {
                        showAnswer(JSON.parse(data.body));
                    });
                    stompClient.subscribe('/state', function(data) {
                        showState(JSON.parse(data.body));
                    });
                    stompClient.subscribe('/countdown', function(data) {
                        showCountDown(JSON.parse(data.body));
                    });
                            stompClient.subscribe('/question', function(messageOutput) {
                        showQuestion(JSON.parse(messageOutput.body));
                    });
                });
            }

            function disconnect() {
                if(stompClient != null) {
                    stompClient.disconnect();
                }
                setConnected(false);
                console.log("Disconnected");
            }

            function sendMessage() {
                var userId = document.getElementById('userId').value;
                var questionId = document.getElementById('questionId').value;
                var selectedOption = document.getElementById('selectedOption').value;
                stompClient.send("/app/401/answer", {},
                  JSON.stringify({'user_id':userId, 'question_id':questionId, 'selected_option':selectedOption}));
            }

            function showQuestion(messageOutput) {
                var response = document.getElementById('question');
                response.innerHTML="<p>"+messageOutput.description+"</p><ol><li>"+messageOutput.options[0].value+"</li><li>"+messageOutput.options[1].value+"</li><li>"+messageOutput.options[2].value+"</li><li>"+messageOutput.options[3].value+"</li></ol>";
                document.getElementById('answer').innerHTML='';
                document.getElementById('countDown').innerHTML='';

            }

            function showAnswer(answer) {
                document.getElementById('answer').innerHTML='Answer:'+answer;
                document.getElementById('question').innerHTML='';
                document.getElementById('countDown').innerHTML='';
            }
            function showCountDown(countDown) {
                document.getElementById('countDown').innerHTML=''+countDown;
                document.getElementById('question').innerHTML='';
                document.getElementById('answer').innerHTML='';
            }
            function showState(state) {
                document.getElementById('state').innerHTML=''+state;
            }

        </script>
</head>
<body>
<div>
    <div>

    </div>
    <br />
    <div>
        <button id="connect" onclick="connect();">Connect</button>
        <button id="disconnect" disabled="disabled" onclick="disconnect();">
            Disconnect
        </button>
    </div>
    <br />
    <div id="conversationDiv">
        <input type="text" id="userId" placeholder="userId"/>
        <input type="text" id="questionId" placeholder="questionId"/>
        <input type="text" id="selectedOption" placeholder="selectedOption"/>
        <button id="sendMessage" onclick="sendMessage();">Send</button>
        <p id="state"></p>
        <p id="countDown"></p>
        <p id="question"></p>
        <p id="answer"></p>
    </div>
</div>

</body>
</html>